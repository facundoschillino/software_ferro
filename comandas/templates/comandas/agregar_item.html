{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Agregar Ítems – Pedido {{ pedido.numero }}</title>
  <link rel="stylesheet" href="{% static 'comandas/css/styles.css' %}">
</head>
<body>
  <div class="container">
    <a href="{% url 'crear_pedido' %}" class="btn btn-secondary">← Atrás</a>
    <header>
      <h2>Pedido N° {{ pedido.numero }}</h2>
      <p>¿Es para llevar?: {{ pedido.para_llevar|yesno:"Sí,No" }}</p>
    </header>

    <!-- Formulario para agregar ítems -->
    <section>
      <h3>Agregar Plato</h3>
      <form method="post">
        {% csrf_token %}
        {{ formset.management_form }}
        {% for form in formset.forms %}
          <div class="item-form mb-4 p-4 bg-card rounded-lg">
            {{ form.id }}

            <div class="form-group">
              {{ form.plato.label_tag }} {{ form.plato }}
              {{ form.plato.errors }}
            </div>

            <div class="form-group">
              {{ form.cantidad.label_tag }} {{ form.cantidad }}
              {{ form.cantidad.errors }}
            </div>

            <div class="form-group">
              {{ form.guarniciones.label_tag }} {{ form.guarniciones }}
              {{ form.guarniciones.errors }}
            </div>

            <div class="form-group">
              {{ form.comentario.label_tag }} {{ form.comentario }}
              {{ form.comentario.errors }}
            </div>

            {% if form.can_delete %}
              <div class="form-group">
                {{ form.DELETE }} <label>Eliminar</label>
              </div>
            {% endif %}
          </div>
        {% endfor %}

        <button type="submit" class="btn btn-secondary">Agregar Ítem</button>
      </form>
    </section>

    <hr>

    <!-- Resumen del pedido -->
    <section>
      <h3>Resumen del Pedido</h3>
      {% if pedido.items.exists %}
        <ul>
          {% for item in pedido.items.all %}
            <li>
              {{ item.cantidad }} x {{ item.plato.nombre }}
              {% if item.guarniciones.all %}
                con {{ item.guarniciones.all|join:", " }}
              {% endif %}
              {% if item.comentario %}
                ({{ item.comentario }})
              {% endif %}
            </li>
          {% endfor %}
        </ul>

        <!-- Finalizar -->
        <form method="post" action="{% url 'finalizar_pedido' %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-primary mt-4">Finalizar Pedido</button>
        </form>

      {% else %}
        <p>No hay ítems cargados aún.</p>
      {% endif %}
    </section>

  </div>
</body>
</html>
